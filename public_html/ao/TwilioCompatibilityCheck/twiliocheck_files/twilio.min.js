Twilio={extend:function(s){for(var v in s)Twilio[v]=s[v]}};
Twilio.extend(function(){var s={},v={},B=function(){function k(a){if(!(a in v)){var f={};s["lib/"+a+".js"].apply(f,[k,f]);v[a]=f}return v[a]}return k}();s["lib/twilio/connection.js"]=function(k,a){function f(a,g,r){if(!(this instanceof f))return new f(a,g,r);this.device=a;this.message=g||{};r=r||{};a={logPrefix:"[Connection]",bridgeToken:null,mediaStreamFactory:b.enabled()?e.PeerConnection:e.MediaStream,chunder:"chunder.prod.twilio.com",chunderw:"chunderw.prod.twilio.com",debug:!1,encrypt:!1,token:null,
secureSignaling:!0};for(var t in a)t in r||(r[t]=a[t]);this.options=r;this.parameters={};this._status=this.options.bridgeToken?"pending":"closed";c.mixinLog(this,this.options.logPrefix);this.log.enabled=this.options.debug;d.mixinEventEmitter(this);this.mediaStream=this.options.mediaStreamFactory(b.enabled()?this.options.secureSignaling:this.options.encrypt,this.options[b.enabled()?"chunderw":"chunder"],this.device.options.simpleDialog);var n=this;this.mediaStream.onerror=function(a){var b={code:a.info.code,
message:a.info.message,info:a.info};n.log("Received an error from MediaStream:",a);n.fire("error",b)};this.mediaStream.onopen=function(){n._status="open";n.mediaStream.publish("input","live");n.mediaStream.attachAudio();n.mediaStream.play("output");n.fire("accept",n)};this.mediaStream.onclose=function(){n._status="closed";n.device.sounds.disconnect()&&n.device.soundcache.play("disconnect");n.fire("disconnect",n)}}var e=k("twilio/factories"),d=k("twilio/eventemitter"),c=k("twilio/log"),g=k("twilio/util"),
b=k("twilio/rtc");f.toString=function(){return"[Twilio.Connection class]"};f.prototype={toString:function(){return"[Twilio.Connection instance]"},sendDigits:function(a){if(a.match(/[^0-9*#w]/))throw new g.Exception("Illegal character passed into sendDigits");this.mediaStream.exec("sendDTMF",a);for(var b=[],r=0;r<a.length;r++){var d="w"!=a[r]?"dtmf"+a[r]:"";"dtmf*"==d&&(d="dtmfs");"dtmf#"==d&&(d="dtmfh");b.push([d,200,20])}this.device.soundcache.playseq(b)},status:function(){return this._status},mute:function(){this.mediaStream.detachAudio()},
unmute:function(){this.mediaStream.attachAudio()},accept:function(a){if("function"==typeof a)return this.addListener("accept",a);var b=this;e.getClass("vendor/mediastream/mediastream","MediaStream");this._status="pending";this.mediaStream.openHelper(function(a,d){if(a)b._die(a,d);else{var n=[],c;for(c in b.message)n.push(encodeURIComponent(c)+"="+encodeURIComponent(b.message[c]));n=[b.mediaStream.uri(),b.options.token,b.options.bridgeToken,n.join("&")].concat(b.options.acceptParams);b.mediaStream.open.apply(b.mediaStream,
n)}},this.device.options.simpleDialog,f.NO_MIC_LEVEL||0,function(){I.dialog.show()},function(a){b.device.showSettings(a)})},reject:function(a){if("function"==typeof a)return this.addListener("reject",a);this.device.stream.publish({Response:"reject",CallSid:this.parameters.CallSid},this.options.rejectChannel);this.fire("reject")},ignore:function(a){if("function"==typeof a)return this.addListener("cancel",a);this._status="closed";this.fire("cancel")},cancel:function(a){this.ignore(a)},disconnect:function(a){if("function"==
typeof a)return this.addListener("disconnect",a);"open"==this._status&&(this.log("Disconnecting..."),this.mediaStream.close())},error:function(a){if("function"==typeof a)return this.addListener("error",a)},_die:function(a,b){this.fire("error",{message:a,code:b})}};a.Connection=f};s["lib/twilio/device.js"]=function(k,a){function f(a,d){if(!(this instanceof f))return new f(a,d);if(!a)throw new h.Exception("Capability token is not valid or missing.");var n={logPrefix:"[Device]",host:"chunder.twilio.com",
chunderw:"chunderw.twilio.com",soundCacheFactory:c.SoundCache,soundFactory:c.Sound,connectionFactory:c.Connection,eventStreamFactory:c.EventStream,presenceFactory:c.Presence,eventsScheme:"wss",eventsHost:"matrix.twilio.com",noRegister:!1,encrypt:!1,simpleDialog:!1,rtc:!0,debug:!1,confirmOnClose:!1,secureSignaling:!0};d=d||{};for(var e in n)e in d||(d[e]=n[e]);this.options=d;this.token=a;this._status="offline";this.connections=[];this.sounds=new l({incoming:!0,outgoing:!0,disconnect:!0});this.options.rtc||
k("twilio/rtc").enabled(!1);this.soundcache=this.options.soundCacheFactory();n={incoming:"sounds/incoming.mp3",outgoing:"sounds/outgoing.mp3",disconnect:"sounds/disconnect.mp3",dtmf1:"sounds/dtmf-1.mp3",dtmf2:"sounds/dtmf-2.mp3",dtmf3:"sounds/dtmf-3.mp3",dtmf4:"sounds/dtmf-4.mp3",dtmf5:"sounds/dtmf-5.mp3",dtmf6:"sounds/dtmf-6.mp3",dtmf7:"sounds/dtmf-7.mp3",dtmf8:"sounds/dtmf-8.mp3",dtmf9:"sounds/dtmf-9.mp3",dtmf0:"sounds/dtmf-0.mp3",dtmfs:"sounds/dtmf-star.mp3",dtmfh:"sounds/dtmf-hash.mp3"};e="undefined"===
typeof z?"":z;for(var q in n){var M=this.options.soundFactory();M.load(e+n[q]);this.soundcache.add(q,M)}this.soundcache.envelope("incoming",{release:2E3});b.mixinLog(this,this.options.logPrefix);this.log.enabled=this.options.debug;g.mixinEventEmitter(this);var x=this;this.addListener("incoming",function(a){a.addListener("accept",function(){x.soundcache.stop("incoming")});a.addListener("cancel",function(){x.soundcache.stop("incoming")});a.addListener("error",function(){x.soundcache.stop("incoming")});
x.sounds.incoming()&&x.soundcache.play("incoming",0,1E3)});this.register(this.token);this.options.confirmOnClose&&(q=function(a){if("busy"==x._status)return(a||window.event).returnValue="A call is currently active."},window.addEventListener?window.addEventListener("beforeunload",q):window.attachEvent&&window.attachEvent("onbeforeunload",q))}function e(a,b,d,c,e){var g={acceptParams:[JSON.stringify(h.getSystemInfo()),h.objectize(a.token).iss],chunder:a.options.host,chunderw:a.options.chunderw,encrypt:a.options.encrypt,
debug:a.options.debug,secureSignaling:a.options.secureSignaling};e=e||{};for(var f in g)f in e||(e[f]=g[f]);"bridge"==d?(e.bridgeToken=b,e.token=null):"jwt"==d?(e.bridgeToken=null,e.token=b):this.log("Unknown token type: "+d);var l=a.options.connectionFactory(a,c,e);l.addListener("accept",function(){a._status="busy";a.fire("connect",l)});l.addListener("error",function(b){a.fire("error",b);if("pending"==l.status()){b=[].concat(a.connections);for(var d=0;d<b.length;d++)l==b[d]&&a.connections.splice(d,
1)}});l.addListener("cancel",function(){a.log("Canceled: "+l.parameters.CallSid);for(var b=[].concat(a.connections),d=0;d<b.length;d++)l==b[d]&&a.connections.splice(d,1);a.fire("cancel",l)});l.addListener("disconnect",function(){"busy"==a._status&&(a._status="ready");a.fire("disconnect",l);for(var b=[].concat(a.connections),d=0;d<b.length;d++)l==b[d]&&a.connections.splice(d,1)});return l}function d(a,b,d,c){c=c||[];for(var e=[],g=0;g<c.length;g++)e.push("feature="+c[g]);c=["AccessToken="+a].concat(e);
return[b+"://"+d,"2012-02-09",h.objectize(a).iss,h.objectize(a).scope["client:incoming"].params.clientName].join("/")+"?"+c.join("&")}var c=k("twilio/factories"),g=k("twilio/eventemitter"),b=k("twilio/log"),h=k("twilio/util"),l=k("twilio/options").Options;k("twilio/dialog");f.toString=function(){return"[Twilio.Device class]"};f.prototype={toString:function(){return"[Twilio.Device instance]"},register:function(a){var b=[],n=null;"client:incoming"in h.objectize(a).scope&&(b.push("incomingCalls"),b.push("publishPresence"),
this.presenceClient&&0<this.presenceClient.handlers.length&&b.push("presenceEvents"),n=d(a,this.options.eventsScheme,this.options.eventsHost,b));var c=this;!n||this.options.noRegister?(this.stream&&(this.stream.destroy(),this.presenceClient&&this.presenceClient.detach(this.stream),this.stream=null),this.log("Unable to receive incoming calls"),"offline"==c._status&&(c._status="ready"),setTimeout(function(){c.fire("ready",c)},0)):this.stream?(this.stream.options.url=n,this.stream.reconnect(a)):(this.log("Registering to stream with url: "+
n),this.stream=this.options.eventStreamFactory(a,{logPrefix:"[Matrix]",debug:this.options.debug,url:n}),this.stream.addListener("ready",function(){c.log("Stream is ready");"offline"==c._status&&(c._status="ready");c.fire("ready",c)}),this.stream.addListener("offline",function(){c.log("Stream is offline");c._status="offline";c.fire("offline",c)}),this.stream.addListener("error",function(a){c.log("Received error: ",a);c.fire("error",a)}),this.stream.addListener("incoming",function(a){c.log("Message incoming...",
a);switch(a.Request){case "invite":if("busy"==c._status){c.log("Device busy; ignoring incoming invite");break}if(!a.Token||!a.CallSid){c.fire("error",{message:"Malformed invite"});break}var b=a.Parameters||{};a=e(c,a.Token,"bridge",{},{rejectChannel:a.RejectChannel});a.parameters=b;c.connections.push(a);c.fire("incoming",a);break;case "cancel":for(var b=[].concat(c.connections),d=0;d<b.length;d++){var n=b[d];n.parameters.CallSid==a.CallSid&&"pending"==n.status()&&n.cancel()}}}),a=h.objectize(a).scope["client:incoming"].params.clientName,
this.presenceClient=this.options.presenceFactory(a,this,this.stream,{autoStart:!0}))},presence:function(a){"client:incoming"in h.objectize(this.token).scope&&(this.presenceClient.handlers.push(a),this.token&&1==this.presenceClient.handlers.length&&this.register(this.token))},showSettings:function(a){f.dialog.show(a);c.getClass("vendor/mediastream/mediastream","MediaStream").showSettings();f.dialog.screen.style.width="200%"},connect:function(a){if("function"==typeof a)return this.addListener("connect",
a);a=a||{};a=e(this,this.token,"jwt",a);this.connections.push(a);if(this.sounds.outgoing()){var b=this;a.accept(function(){b.soundcache.play("outgoing")})}a.accept();return a},disconnectAll:function(){for(var a=[].concat(this.connections),b=0;b<a.length;b++)a[b].disconnect();0<this.connections.length&&this.log("Connections left pending: "+this.connections.length)},destroy:function(){this.stream.destroy();this.swf&&this.swf.disconnect&&this.swf.disconnect()},disconnect:function(a){this.addListener("disconnect",
a)},incoming:function(a){this.addListener("incoming",a)},offline:function(a){this.addListener("offline",a)},ready:function(a){this.addListener("ready",a)},error:function(a){this.addListener("error",a)},status:function(){return this._status}};f=function(a){var b=[],d=[],c=function(b){if(a.instance)return b();d.push(b)},e=function(b){b=(b.code?b.code+": ":"")+b.message;a.instance&&a.instance.log(b);throw new h.Exception(b);},g={instance:null,setup:function(c,g){if(a.instance)a.instance.log("Found existing Device; using new token but ignoring options"),
a.instance.token=c,a.instance.register(c);else{a.instance=new f(c,g);a.sounds=a.instance.sounds;for(var h=0;h<d.length;h++)d[h]();a.error(e)}for(h=0;h<b.length;h++)b[h](c,g);b=[];return a},connect:function(b){if("function"==typeof b)c(function(){a.instance.addListener("connect",b)});else{if(!a.instance)throw new h.Exception("Run Twilio.Device.setup()");if(0<a.instance.connections.length)a.instance.fire("error",{message:"A connection is currently active"});else return a.instance.connect(b)}},disconnectAll:function(){c(function(){a.instance.disconnectAll()});
return a},disconnect:function(b){c(function(){a.instance.addListener("disconnect",b)});return a},status:function(){return a.instance._status},ready:function(b){c(function(){a.instance.addListener("ready",b)});return a},error:function(b){c(function(){b!=e&&a.instance.removeListener("error",e);a.instance.addListener("error",b)});return a},presence:function(b){c(function(){a.instance.presence(b)});return a},offline:function(b){c(function(){a.instance.addListener("offline",b)});return a},incoming:function(b){c(function(){a.instance.addListener("incoming",
b)});return a},destroy:function(){a.instance&&a.instance.destroy();return a},cancel:function(b){c(function(){a.instance.addListener("cancel",b)});return a},showPermissionsDialog:function(){if(!a.instance)throw new h.Exception("Run Twilio.Device.setup()");a.instance.showSettings()},__afterSetup:function(a){b.push(a)}},l;for(l in g)a[l]=g[l];return a}(f);f.dialog=c.Dialog();a.Device=f};s["lib/twilio/dialog.js"]=function(k,a){var f=function(){function a(){var d=document.createElement("div"),c=document.createElement("div"),
e=document.createElement("button");d.style.position="fixed";d.style.zIndex="99999";d.style.top="0";d.style.left="0";d.style.width="1px";d.style.height="1px";d.style.overflow="hidden";d.style.visibility="hidden";c.style.margin="10% auto 0";c.style.width="215px";c.style.borderRadius="8px";c.style.backgroundColor="#f8f8f8";c.style.border="8px solid rgb(160, 160, 160)";var b=this,h=function(){b.hide();b.closeCb&&b.closeCb.call()};e.appendChild(document.createTextNode("Close"));window.addEventListener?
e.addEventListener("click",h,!1):e.attachEvent("onclick",h);d.appendChild(c);c.appendChild(e);this.screen=d;this.dialog=c;this.close=e;this.container=null;this.inserted=!1;this.embed=function(){};document.body?(document.body.appendChild(d),b.inserted=!0):(b=this,c=function(){document.body.appendChild(d);b.inserted=!0;b.embed()},window.addEventListener?window.addEventListener("load",c,!1):window.attachEvent("onload",c))}a.prototype={insert:function(a,c){if(this.container){if(this.container==a)return;
this.dialog.removeChild(this.container)}this.container=a;this.dialog.insertBefore(a,this.close);this.embed=c||this.embed();this.inserted&&this.embed()},show:function(a){this.closeCb=a;this.screen.style.width="100%";this.screen.style.height="auto";this.screen.style.visibility="visible";a=this.dialog.style.width.replace("px","")|0;var c=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;this.dialog.style.marginLeft=(((window.innerWidth||document.documentElement.clientWidth||
document.body.clientWidth)-a)/2|0)+"px";this.dialog.style.marginTop=(0.1*c|0)+"px"},hide:function(){this.screen.style.width="1px";this.screen.style.height="1px";this.screen.style.visibility="hidden"}};return a}();a.Dialog=f};s["lib/twilio/eventemitter.js"]=function(k,a){function f(a,c,e){c=c||[];if(0==c.length)return-1;if(!e&&c.indexOf)return c.indexOf(a);for(e=0;e<c.length;e++)if(c[e]===a)return e;return-1}var e={addListener:function(a,c){if("function"!=typeof c)throw new (k("twilio/util").Exception)("Listener must be a function, not "+
typeof c);this.handlers[a]=this.handlers[a]||[];this.handlers[a].push(c);this.log('Registered listener for event type "'+a+'"');return this},hasListener:function(a,c){return-1!=f(c,this.handlers[a])},removeListener:function(a,c){var e=f(c,this.handlers[a]);-1<e&&(this.handlers[a].splice(e,1),this.log('Removed listener for event type "'+a+'"'));return this},fire:function(){var a=Array.prototype.slice.call(arguments,0),c=a.shift(),e=this.handlers[c]||[];this.log('Invoke listeners for event type "'+
c+'"');for(c=0;c<e.length;c++)e[c].apply(this,a)}};a.mixinEventEmitter=function(a){a.handlers=a.handlers||{};a.log=a.log||function(){};for(var c in e)a[c]||(a[c]=function(a,b){return function(){var c=Array.prototype.slice.call(arguments,0);return e[b].apply(a,c)}}(a,c))}};s["lib/twilio/eventstream.js"]=function(k,a){function f(a,c){if(!a.fire||!a.addListener)throw new b.Exception("Object is not event savvy");return function(){var b=Array.prototype.slice.call(arguments,0);if("function"==typeof b[0])return a.addListener(c,
b[0]);b.unshift(c);return a.fire.apply(a,b)}}function e(a,b){var c;c="string"!=typeof a?"":a.trim?a.trim():a.replace(/^\s+|\s+$/g,"");return 0==c.length?[]:c.split("\n")}function d(a,b){if(!(this instanceof d))return new d(a,b);var e={logPrefix:"[EventStream]",scheme:"wss",host:"stream.twilio.com",reconnect:!0,url:null,flashTimeout:5E3,filters:{},debug:!1};b=b||{};for(var h in e)h in b||(b[h]=e[h]);this.options=b;this.token=a||"";this.handlers={};this.status="offline";g.mixinLog(this,this.options.logPrefix);
this.log.enabled=this.options.debug;this.heartbeat=new l({interval:15});c.mixinEventEmitter(this);this._connect();e="incoming ready offline sms call twiml error".split(" ");for(h=0;h<e.length;h++)this[e[h]]=f(this,e[h]);var q=this;this.addListener("publish",function(a){q.fire("twiml",a)})}var c=k("twilio/eventemitter"),g=k("twilio/log"),b=k("twilio/util"),h=k("twilio/factories"),l=k("twilio/heartbeat").Heartbeat;d.initializingFlash=!1;d.initializeFlash=function(a){d.initializingFlash||(d.initializingFlash=
!0,window.WebSocket&&window.WebSocket.__initialize&&(G=a.options.swfLocation,window.WebSocket.__initialize(),a.log("Waiting "+a.options.flashTimeout+"ms for flash to initialize"),window.setTimeout(function(){window.WebSocket.__flash||a.log("WebSocket did not initialize")},a.options.flashTimeout)))};d.toString=function(){return"[Twilio.EventStream class]"};d.prototype={toString:function(){return"[Twilio.EventStream instance]"},destroy:function(){this.socket.close();this.options.reconnect=!1;return this},
publish:function(a,b){try{this.socket.send(JSON.stringify({"rt.message":"publish","rt.subchannel":b,"rt.payload":a}))}catch(c){this.log("Error while publishing to eventstream. Reconnecting socket."),this.socket&&this.socket.close(),this._tryReconnect()}},_cleanupSocket:function(a){if(a){var b=function(){};a.onopen=function(){a.close()};a.onmessage=b;a.onerror=b;a.onclose=b;2>a.readyState&&a.close()}},_connect:function(a){var b=this,c=this._extractUrl(),d=++a||1;if(c){var g=this.socket;this.log("Attempting to connect to "+
c+"...");try{this.socket=h.WebSocket(c)}catch(f){this.log("Connection to "+c+" failed: "+(f.message||""));return}this.socket.onopen=function(){b.log("Socket opened... sending ready signal");b._cleanupSocket(g);b.socket.send(JSON.stringify({"rt.message":"listen","rt.token":b.token}))};this.socket.onerror=function(a){a.data?b.fire("error",{message:a.data.message||"",code:a.data.code||""}):b.log("Received message event:",a)};this.socket.onmessage=function(a){b.heartbeat.beat();if("\n"!=a.data){a=e(a.data);
for(var h=0;h<a.length;h++){var g=JSON.parse(a[h]);if("ready"==g["rt.message"])"ready"!=b.status&&(b.status="ready",b.fire("ready",b));else{var f=g["rt.message"]||g.EventType;if("error"==f){var l=g.message||"";b.log("Connection to "+c+" failed: "+l);/^4/.test(g.code)?b.options.reconnect=!1:5>d?(l=50*Math.pow(2,d),l=30+Math.round(Math.random()*l),setTimeout(function(){b.socket&&b.socket.close();b._connect(d)},l)):b.fire("error",{message:"Connection to Twilio failed: "+l,code:g.code||""})}"incoming"!=
f&&b.fire("incoming",g);b.fire(f,g)}}}};this.socket.onclose=function(){b._cleanupSocket(g);"offline"!=b.status&&(b.log("Gone offline"),b.status="offline",b.fire("offline",b))};this.heartbeat.onsleep=function(){b.log("Connection heartbeat timed out.");b.socket&&b.socket.close();b._tryReconnect(5E3)}}else this.log("Nothing to do")},reconnect:function(a){this.socket&&(0==this.socket.readyState?(socket=this.socket,socket.onopen=function(){socket.close()}):this.socket.close());this.token=a;this.options.reconnect=
!0;this._tryReconnect()},_extractUrl:function(){if(this.options.url)return this.options.url;var a=b.objectize(this.token).scope;if(!("stream:subscribe"in a))return null;var a=a["stream:subscribe"],a=a.params&&a.params.path?a.params.path:"/",c=this.options.filters;c.AccessToken=this.token;return this.options.scheme+"://"+this.options.host+a+"?"+b.urlencode(c,!0)},_tryReconnect:function(a){(new Date).getTime();if(this.options.reconnect&&null!=this._extractUrl()){a=a||5E3;this._connect();var b=function(b){return function(){b._tryReconnect(2*
a)}}(this),c=function(d){return function(){switch(d.socket.readyState){case 0:window.setTimeout(c,1E3);break;case 1:break;default:window.setTimeout(b,a)}}}(this);window.setTimeout(c,5E3)}}};d=function(a){var b=[],c=function(c){if(a.instance)return c();b.push(c)},d={instance:null,status:"offline",setup:function(c,d){a.instance=new a(c,d);for(var e=0;e<b.length;e++)b[e]();a.ready(function(){a.status="ready"});a.offline(function(){a.status="offline"});return a},incoming:function(b){c(function(){a.instance.incoming(b)});
return a},ready:function(b){c(function(){a.instance.ready(b)});return a},offline:function(b){c(function(){a.instance.offline(b)});return a},sms:function(b){c(function(){a.instance.sms(b)});return a},call:function(b){c(function(){a.instance.call(b)});return a},twiml:function(b){c(function(){a.instance.twiml(b)});return a},error:function(b){c(function(){a.instance.error(b)});return a}},e;for(e in d)a[e]=d[e];return a}(d);a.EventStream=d};s["lib/twilio/factories.js"]=function(k,a){function f(a,c){if(!a.apply)return e(a,
c);var d=function(){};d.prototype=a.prototype;c=Array.prototype.slice.call(c,0);d=new d;try{var g=a.apply(d,c)}catch(f){return e(a,c)}return"object"===typeof g?g:d}function e(a,c){var d=c.length;if(0===d)return new a;if(1===d)return new a(c[0]);if(2===d)return new a(c[0],c[1]);if(3===d)return new a(c[0],c[1],c[2]);if(4===d)return new a(c[0],c[1],c[2],c[3])}function d(a,d,e){var r=a+"/"+d;e&&(g[r]=e);return function(){var e=c[r]||(g[r]?g[r]():k(a)[d]);return f(e,arguments)}}var c={},g={};a.registerClass=
function(a,d,e){c[a+"/"+d]=e};a.getClass=function(a,d){var e=a+"/"+d;return c[e]||(g[e]?g[e]():void 0)};a.Presence=d("twilio/presence","Presence");a.Device=d("twilio/device","Device");a.Dialog=d("twilio/dialog","Dialog");a.Connection=d("twilio/connection","Connection");a.EventStream=d("twilio/eventstream","EventStream");a.SoundCache=d("twilio/soundcache","SoundCache");a.PeerConnection=d("twilio/rtc","PeerConnection");a.MediaStream=d("vendor/swfobject","swfobject",function(){return A});a.Sound=d("vendor/sound/sound",
"Sound",function(){return Twilio.Sound});a.WebSocket=d("vendor/web-socket-js/websocket","WebSocket",function(){return WebSocket});a.MediaStream=d("vendor/mediastream/mediastream","MediaStream",function(){return Twilio.MediaStream})};s["lib/twilio/heartbeat.js"]=function(k,a){function f(a){if(!(this instanceof f))return new f(a);a=a||{};var d=function(){},d={interval:10,now:function(){return(new Date).getTime()},repeat:function(a,b){return setInterval(a,b)},stop:function(a,b){return clearInterval(a,
b)},onsleep:d,onwakeup:d},c;for(c in d)c in a||(a[c]=d[c]);this.interval=a.interval;this.lastbeat=0;this.pintvl=null;this.onsleep=a.onsleep;this.onwakeup=a.onwakeup;this.repeat=a.repeat;this.stop=a.stop;this.now=a.now}f.toString=function(){return"[Twilio.Heartbeat class]"};f.prototype={toString:function(){return"[Twilio.Heartbeat instance]"},beat:function(){this.lastbeat=this.now();if(this.sleeping()){if(this.onwakeup)this.onwakeup();var a=this;this.pintvl=this.repeat.call(null,function(){a.check()},
1E3*this.interval)}},check:function(){var a=this.now()-this.lastbeat;if(!this.sleeping()&&a>=1E3*this.interval){if(this.onsleep)this.onsleep();this.stop.call(null,this.pintvl);this.pintvl=null}},sleeping:function(){return null==this.pintvl}};a.Heartbeat=f};s["lib/twilio/log.js"]=function(k,a){a.mixinLog=function(a,e){function d(){if(d.enabled)for(var a=d.prefix?d.prefix+" ":"",e=0;e<arguments.length;e++){var b=arguments[e];d.handler("string"==typeof b?a+b:b)}}d.enabled=!0;d.prefix=e||"";d.defaultHandler=
function(a){window.console&&console.log(a)};d.handler=d.defaultHandler;a.log=d}};s["lib/twilio/options.js"]=function(k,a){var f=function(){function a(c,g){if(!(this instanceof a))return new a(c);this.__dict__={};c=c||{};g=g||{};for(var b in c)this[b]=d(this.__dict__,b),this[b](c[b]);for(b in g)this[b](g[b])}function d(a,d){return function(b){return"undefined"==typeof b?a[d]:a[d]=b}}return a}();a.Options=f};s["lib/twilio/presence.js"]=function(k,a){var f=k("twilio/util").Set,e=k("twilio/util").bind,
d=k("twilio/options").Options,c=k("twilio/state"),g=300,b=0.2,h=function(a,b){return a+a*(2*Math.random()+-1)*b},l=function(){function a(h,n,l,q){this.roster=new f;this.handlers=[];this.clientName=h;this.options=new d({autoStart:!1,interval:g,variation:b,clearTimeout:function(a){return clearTimeout(a)},setTimeout:function(a,b){return setTimeout(a,b)}},q);this._boundPresence=e(this.handlePresence,this);this._boundRoster=e(this.handleRoster,this);n.addListener("offline",e(this.handleOffline,this));
this.attach(l);this._boundHeartbeat=e(this.heartbeat,this,l,{ttl:2*this.options.interval(),availability:"available",keepalive:!0});h=new c.StateM({stop:"start",start:"stop"},this);this.start=h.doStart;this.stop=h.doStop;this.options.autoStart()&&this.start()}a.prototype.enterStart=function(a,b){b={tid:null};var c=this;(function M(){var a=h(c.options.interval(),c.options.variation());b.tid=c.options.setTimeout()(function(){c._boundHeartbeat();M()},1E3*a)})();return b};a.prototype.enterStop=function(a,
b){this.options.clearTimeout()(b.tid)};a.prototype.heartbeat=function(a,b){a.publish(b,"presence")};a.prototype.attach=function(a){a.addListener("presence",this._boundPresence);a.addListener("roster",this._boundRoster)};a.prototype.detach=function(a){a.removeListener("presence",this._boundPresence);a.removeListener("roster",this._boundRoster)};a.prototype.removeFromRoster=function(a){this.roster.del(a);this.invoke(a,!1)};a.prototype.addToRoster=function(a){this.roster.put(a);this.invoke(a,!0)};a.prototype.handleOffline=
function(){var a=e(this.removeFromRoster,this);this.roster.map(a)};a.prototype.handlePresence=function(a){this[a.Available?"addToRoster":"removeFromRoster"](a.From)};a.prototype.handleRoster=function(a){for(var b=0;b<a.Roster.length;b++)this.addToRoster(a.Roster[b])};a.prototype.invoke=function(a,b){if(a!==this.clientName)for(var c={from:a,available:b},d=0;d<this.handlers.length;d++)this.handlers[d](c)};return a}();a.Presence=l};s["lib/twilio/rtc.js"]=function(k,a){var f=k("twilio/factories"),e=k("twilio/util"),
d=function(a,b){var c=function(){};this.onclose=this.onerror=this.onopen=c;this.stream=this.sock=this.version=null;this._uri=(a?"wss://":"ws://")+b+"/signal";this.video=document.createElement("video");this.video.autoplay="autoplay";this.sendHangup=!0};d.prototype={uri:function(){return this._uri},openHelper:function(a){var b=this;d.getUserMedia({audio:!0},function(c){b.stream=c;a()},function(b){b.code==b.PERMISSION_DENIED?a("User denied access to microphone.",31208):a("Error occurred while accessing microphone.",
31201)})},_setupPeerConnection:function(){var a=d.protocol;a.create();a.pc.addStream(this.stream);var b=this;a.pc.onaddstream=function(a){b.video.src=webkitURL.createObjectURL(a.stream)};a.createOffer({audio:!0});return a},_setupChannel:function(a,b,c,d,k,t){try{var n=f.WebSocket(a)}catch(R){this.onerror({info:R.message});this.close();return}var q=this;n.onopen=function(){q.version.pc.onopen=q.onopen;q.version.pc.onstatechange=function(a){if(q.version.pc&&"stable"==q.version.pc.readyState)q.onopen()};
q.version.pc.onsignalingstatechange=function(a){if(q.version.pc&&"stable"==q.version.pc.signalingState)q.onopen()};n.send(JSON.stringify({type:"OFFER",sdp:q.version.getSDP(),twilio:{appsid:b?e.objectize(b).iss:null,token:b,bridgeToken:c,params:d,extras:[k,t]}}))};n.onmessage=function(a){if("\n"==a.data)n.send("\n");else if(a=JSON.parse(a.data),"ANSWER"===a.type)q.version.processAnswer(a.sdp);else if("CANDIDATE"===a.type)q.version.processCandidate(a.candidate,a.label);else if("HANGUP"===a.type){if(a.error)q.onerror({info:{code:a.error.code,
message:a.error}});q.sendHangup=!1;q.close()}};n.onclose=function(){q.sock&&q.close()};return n},open:function(a,b,c,d,e,f){this.sock||(this.version=this._setupPeerConnection(),this.sock=this._setupChannel(a,b,c,d,e,f))},exec:function(a){var b=[].slice.call(arguments,1);if("sendDTMF"===a){var c=b[0];c&&c.length&&this.sock&&this.sock.send(JSON.stringify({type:"DTMF",dtmf:b[0]}))}},close:function(){this.version.pc&&(this.version.pc.close(),this.version.pc=null);this.sock&&(this.sendHangup&&this.sock.send(JSON.stringify({type:"HANGUP"})),
this.sock.close(),this.sock=null);this.stream&&(this.stream.stop(),this.stream=null);this.video.src="";this.onclose()},play:function(){},publish:function(){},attachAudio:function(){this.stream&&((this.stream.audioTracks||this.stream.getAudioTracks())[0].enabled=!0)},detachAudio:function(){this.stream&&((this.stream.audioTracks||this.stream.getAudioTracks())[0].enabled=!1)}};d.getUserMedia=function(a,b,c){"undefined"!=typeof navigator&&navigator.webkitGetUserMedia(a,b,c)};var c=function(){};c.prototype.create=
function(){this.pc=new webkitRTCPeerConnection({iceServers:[]},{optional:[{DtlsSrtpKeyAgreement:!1}]})};c.prototype.createOffer=function(a){var b=this,c=function(a){if("undefined"===typeof a)return null;nc={mandatory:{}};"undefined"!==typeof a.audio&&(nc.mandatory.OfferToReceiveAudio=a.audio);"undefined"!==typeof a.video&&(nc.mandatory.OfferToReceiveVideo=a.video);return nc},d=function(a){b.pc.setLocalDescription(new RTCSessionDescription(a))},e=function(a){};try{this.pc.createOffer(d,e,a)}catch(f){this.pc.createOffer(d,
e,c(a))}};c.prototype.getSDP=function(){return this.pc.localDescription.sdp};c.prototype.processAnswer=function(a){this.pc.setRemoteDescription(new RTCSessionDescription({sdp:a,type:"answer"}))};c.prototype.processCandidate=function(a,b){return this.pc.addIceCandidate(new RTCIceCandidate({sdpMLineIndex:0,candidate:a}))};c.test=function(){return"object"==typeof navigator&&navigator.webkitGetUserMedia&&"function"==typeof webkitRTCPeerConnection};c=c.test()?new c:null;d.protocol=c;d.enabled=!!d.protocol;
a.PeerConnection=d;a.enabled=function(a){"undefined"!==typeof a&&(d.enabled=a);return d.enabled}};s["lib/twilio/soundcache.js"]=function(k,a){function f(a,c){return function(){var e=Array.prototype.slice(arguments);c.apply(a,e)}}function e(){if(!(this instanceof e))return new e;this.cache={}}e.prototype={add:function(a,c,e){e=e||{};if(!(e instanceof Object))throw new TypeError("Bad envelope type; expected Object");c instanceof Array||(c=[c]);this.cache[a]={starttime:null,sounds:c,envelope:e}},play:function(a,
c,e){c=c||0;e=e||1;if(a in this.cache){a=this.cache[a];for(var b=0;b<a.sounds.length;b++)a.sounds[b].play(c,e);a.starttime=(new Date).getTime()}},stop:function(a){if(a in this.cache){var c=this.cache[a];a=c.envelope.release||0;var e=function(){for(var a=0;a<c.sounds.length;a++)c.sounds[a].stop()},b=(new Date).getTime(),b=Math.max(0,a-(b-c.starttime));0==a?e():setTimeout(e,b)}},envelope:function(a,c){if(a in this.cache){var e=this.cache[a],b;for(b in c)e.envelope[b]=c[b]}},playseq:function(){var a=
null,c=[],e=function(){var b=c.shift();if(b){var h=b[0],l=b[1]||0,b=b[2]||0;h in this.cache&&this.play(h);a=setTimeout(f(this,e),l+b)}else a=null};return function(b){for(var h=0;h<b.length;h++)c.push(b[h]);null==a&&(a=setTimeout(f(this,e),0))}}()};a.SoundCache=e};s["lib/twilio/state.js"]=function(k,a){var f,e,d,c,g,b={}.hasOwnProperty,h=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);e.prototype=c.prototype;a.prototype=new e;a.__super__=c.prototype;return a},
l=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1},r=[].slice;g=function(a){return a.substr(0,1).toUpperCase()+a.slice(1)};c=function(a){var b,c,d;d=[];for(b in a)c=a[b],d.push(new e(b,c));return d};d=function(a){function b(){b.__super__.constructor.apply(this,arguments)}h(b,a);return b}(Error);e=function(){return function(a,b,c){this.froms=a;this.to=b;this.name=c;this.froms instanceof Array||(this.froms=[this.froms]);this.name=this.name||"do"+
g(this.to)}}();f=function(){function a(b,e,d){var f;this.ctx=null!=e?e:this;this.stateData=null!=d?d:[];e=c(b);if(0===e.length)throw Error("Must initialize with at least one transition");this.state=e[0].froms[0];this.stateData instanceof Array||(this.stateData=[this.stateData]);d=0;for(f=e.length;d<f;d++)b=e[d],this.makeEvent(b)}a.prototype.makeEvent=function(a){var b=this;return this[a.name]=function(){var c;if(c=b.state,0>l.call(a.froms,c))throw new d("Not a valid transition");b.stateData=b.invoke.apply(b,
["leave",b.state,a].concat(r.call(b.stateData)));b.stateData=b.invoke.apply(b,["enter",a.to,a].concat(r.call(b.stateData)));return b.state=a.to}};a.prototype.invoke=function(){var a,b,c,e,d;b=arguments[0];c=arguments[1];e=arguments[2];a=4<=arguments.length?r.call(arguments,3):[];b+=g(c);return this.ctx[b]?(a=(d=this.ctx)[b].apply(d,[e].concat(r.call(a))),"undefined"===typeof a&&(a=[]),a instanceof Array?a:[a]):a};return a}();a.TransitionError=d;a.Transition=e;a.StateM=f};s["lib/twilio/util.js"]=function(k,
a){function f(a){if(!(this instanceof f))return new f(a);this.message=a}function e(a){return function(){var b=Array.prototype.slice.call(arguments,0);a.memo=a.memo||{};return a.memo[b]?a.memo[b]:a.memo[b]=a.apply(null,b)}}function d(a){a=a.split(".");if(3!=a.length)throw new f("Wrong number of segments");return l(a[1])}function c(a){if(""==a)return{};if(-1==a.indexOf("&")&&-1==a.indexOf("="))return a;a=a.split("&");for(var b={},e=0;e<a.length;e++){var d=a[e].split("=");b[decodeURIComponent(d[0])]=
c(decodeURIComponent(d[1]))}return b}function g(a){try{return btoa(a)}catch(b){try{return(new Buffer(a)).toString("base64")}catch(c){return Twilio._phpjs_btoa(a)}}}function b(a){try{return atob(a)}catch(b){try{return(new Buffer(a,"base64")).toString("ascii")}catch(c){return Twilio._phpjs_atob(a)}}}function h(a){var b=[],c;for(c in a){var e="object"==typeof a[c]?h(a[c]):a[c];b.push(encodeURIComponent(c)+"="+encodeURIComponent(e))}return b.join("&")}f.prototype.toString=function(){return"Twilio.Exception: "+
this.message};var l=e(function(a){var c=a.length%4;0<c&&(a+=Array(4-c+1).join("="));a=a.replace(/-/g,"+").replace(/_/g,"/");a=b(a);return JSON.parse(a)}),r=e(function(a){a=d(a);for(var b=0===a.scope.length?[]:a.scope.split(" "),e={},h=0;h<b.length;h++){var g;g=b[h].match(/^scope:(\w+):(\w+)\??(.*)$/);if(!g||4!=g.length)throw new f("Bad scope URI");g={service:g[1],privilege:g[2],params:c(g[3])};e[g.service+":"+g.privilege]=g}a.scope=e;return a}),t=function(){function a(){this.set={}}a.prototype.clear=
function(){this.set={}};a.prototype.put=function(b){return this.set[b]=a.DUMMY};a.prototype.del=function(a){return delete this.set[a]};a.prototype.map=function(a,b){var c=[],e;for(e in this.set)c.push(a.call(b,e));return c};a.DUMMY={};return a}();a.encodescope=function(a,b,c){a=["scope",a,b].join(":");b=!0;for(var e in c){b=!1;break}return b?a:a+"?"+h(c)};a.dummyToken=function(a){var b={iss:"AC1111111111111111111111111111111",exp:14E8},c;for(c in b)a[c]=a[c]||b[c];a=g(JSON.stringify(a));a=a.replace(/=/g,
"").replace(/\+/g,"-").replace(/\//g,"_");return["*",a,"*"].join(".")};a.Exception=f;a.decode=d;a.btoa=g;a.atob=b;a.objectize=r;a.urlencode=function(a,b){var c=[];b=b||!1;for(var e in a)if(b&&a[e]instanceof Array)for(var d in a[e]){var f=a[e][d];c.push(encodeURIComponent(e)+"="+encodeURIComponent(f))}else f=a[e],c.push(encodeURIComponent(e)+"="+encodeURIComponent(f));return c.join("&")};a.Set=t;a.bind=function(a,b){var c=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);
return a.apply(b,c.concat(e))}};a.getSystemInfo=function(){var a=k("twilio/factories"),b=k("twilio/rtc"),a=a.getClass("vendor/swfobject","swfobject"),c="undefined"!=typeof navigator?navigator:{},c={p:"browser",v:"1.1",browser:{userAgent:c.userAgent||"unknown",platform:c.platform||"unknown"}};b.enabled()?c.plugin="rtc":(c.plugin="flash",c.flash={v:a.getFlashPlayerVersion()});return c}};s["lib/twilio.js"]=function(k,a){a.Device=k("twilio/device").Device;a.EventStream=k("twilio/eventstream").EventStream;
a.Connection=k("twilio/connection").Connection;a.require=k};var z="undefined"!=typeof z?z:function(){for(var k=window.location.protocol||"http:",a="//static.twilio.com/libs/twiliojs/1.0/",f=document.getElementsByTagName("script"),e=/(\w+:)?(\/\/.*)(twilio.min.js|twilio.js)/,d=0;d<f.length;d++){var c=f[d].src.match(e);if(c){k=c[1]||k;a=c[2];break}}return k+a}(),G=z+"WebSocket.swf";window&&(window.WEB_SOCKET_SWF_LOCATION=G);this.JSON||(JSON=function(){function k(a){return 10>a?"0"+a:a}function a(e,
d){var c,g,b,h;c=/["\\\x00-\x1f\x7f-\x9f]/g;var l;switch(typeof e){case "string":return c.test(e)?'"'+e.replace(c,function(a){var b=f[a];if(b)return b;b=a.charCodeAt();return"\\u00"+Math.floor(b/16).toString(16)+(b%16).toString(16)})+'"':'"'+e+'"';case "number":return isFinite(e)?String(e):"null";case "boolean":case "null":return String(e);case "object":if(!e)return"null";if("function"===typeof e.toJSON)return a(e.toJSON());c=[];if("number"===typeof e.length&&!e.propertyIsEnumerable("length")){h=
e.length;for(g=0;g<h;g+=1)c.push(a(e[g],d)||"null");return"["+c.join(",")+"]"}if(d)for(h=d.length,g=0;g<h;g+=1)b=d[g],"string"===typeof b&&(l=a(e[b],d))&&c.push(a(b)+":"+l);else for(b in e)"string"===typeof b&&(l=a(e[b],d))&&c.push(a(b)+":"+l);return"{"+c.join(",")+"}"}}Date.prototype.toJSON=function(){return this.getUTCFullYear()+"-"+k(this.getUTCMonth()+1)+"-"+k(this.getUTCDate())+"T"+k(this.getUTCHours())+":"+k(this.getUTCMinutes())+":"+k(this.getUTCSeconds())+"Z"};var f={"\b":"\\b","\t":"\\t",
"\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return{stringify:a,parse:function(a,d){function c(a,e){var f,g;if(e&&"object"===typeof e)for(f in e)Object.prototype.hasOwnProperty.apply(e,[f])&&(g=c(f,e[f]),void 0!==g&&(e[f]=g));return d(a,e)}var f;if(/^[\],:{}\s]*$/.test(a.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return f=eval("("+a+")"),"function"===typeof d?c("",f):f;throw new SyntaxError("parseJSON");
}}}());var A=function(){function k(){if(!H){try{var a=p.getElementsByTagName("body")[0].appendChild(p.createElement("span"));a.parentNode.removeChild(a)}catch(b){return}H=!0;for(var a=N.length,c=0;c<a;c++)N[c]()}}function a(a){H?a():N[N.length]=a}function f(a){if(typeof w.addEventListener!=u)w.addEventListener("load",a,!1);else if(typeof p.addEventListener!=u)p.addEventListener("load",a,!1);else if(typeof w.attachEvent!=u)s(w,"onload",a);else if("function"==typeof w.onload){var b=w.onload;w.onload=
function(){b();a()}}else w.onload=a}function e(){var a=p.getElementsByTagName("body")[0],b=p.createElement(C);b.setAttribute("type",v);var c=a.appendChild(b);if(c){var e=0;(function(){if(typeof c.GetVariable!=u){var f=c.GetVariable("$version");f&&(f=f.split(" ")[1].split(","),m.pv=[parseInt(f[0],10),parseInt(f[1],10),parseInt(f[2],10)])}else if(10>e){e++;setTimeout(arguments.callee,10);return}a.removeChild(b);c=null;d()})()}else d()}function d(){var a=E.length;if(0<a)for(var e=0;e<a;e++){var d=E[e].id,
f=E[e].callbackFn,l={success:!1,id:d};if(0<m.pv[0]){var k=n(d);if(k)if(!q(E[e].swfVersion)||m.wk&&312>m.wk)if(E[e].expressInstall&&g()){l={};l.data=E[e].expressInstall;l.width=k.getAttribute("width")||"0";l.height=k.getAttribute("height")||"0";k.getAttribute("class")&&(l.styleclass=k.getAttribute("class"));k.getAttribute("align")&&(l.align=k.getAttribute("align"));for(var r={},k=k.getElementsByTagName("param"),p=k.length,t=0;t<p;t++)"movie"!=k[t].getAttribute("name").toLowerCase()&&(r[k[t].getAttribute("name")]=
k[t].getAttribute("value"));b(l,r,d,f)}else h(k),f&&f(l);else x(d,!0),f&&(l.success=!0,l.ref=c(d),f(l))}else x(d,!0),f&&((d=c(d))&&typeof d.SetVariable!=u&&(l.success=!0,l.ref=d),f(l))}}function c(a){var b=null;(a=n(a))&&"OBJECT"==a.nodeName&&(typeof a.SetVariable!=u?b=a:(a=a.getElementsByTagName(C)[0])&&(b=a));return b}function g(){return!O&&q("6.0.65")&&(m.win||m.mac)&&!(m.wk&&312>m.wk)}function b(a,b,c,e){O=!0;G=e||null;L={success:!1,id:c};var d=n(c);if(d){"OBJECT"==d.nodeName?(K=l(d),P=null):
(K=d,P=c);a.id=B;if(typeof a.width==u||!/%$/.test(a.width)&&310>parseInt(a.width,10))a.width="310";if(typeof a.height==u||!/%$/.test(a.height)&&137>parseInt(a.height,10))a.height="137";p.title=p.title.slice(0,47)+" - Flash Player Installation";e=m.ie&&m.win?"ActiveX":"PlugIn";e="MMredirectURL="+w.location.toString().replace(/&/g,"%26")+"&MMplayerType="+e+"&MMdoctitle="+p.title;b.flashvars=typeof b.flashvars!=u?b.flashvars+("&"+e):e;m.ie&&m.win&&4!=d.readyState&&(e=p.createElement("div"),c+="SWFObjectNew",
e.setAttribute("id",c),d.parentNode.insertBefore(e,d),d.style.display="none",function(){4==d.readyState?d.parentNode.removeChild(d):setTimeout(arguments.callee,10)}());r(a,b,c)}}function h(a){if(m.ie&&m.win&&4!=a.readyState){var b=p.createElement("div");a.parentNode.insertBefore(b,a);b.parentNode.replaceChild(l(a),b);a.style.display="none";(function(){4==a.readyState?a.parentNode.removeChild(a):setTimeout(arguments.callee,10)})()}else a.parentNode.replaceChild(l(a),a)}function l(a){var b=p.createElement("div");
if(m.win&&m.ie)b.innerHTML=a.innerHTML;else if(a=a.getElementsByTagName(C)[0])if(a=a.childNodes)for(var c=a.length,e=0;e<c;e++)1==a[e].nodeType&&"PARAM"==a[e].nodeName||8==a[e].nodeType||b.appendChild(a[e].cloneNode(!0));return b}function r(a,b,c){var e,d=n(c);if(m.wk&&312>m.wk)return e;if(d)if(typeof a.id==u&&(a.id=c),m.ie&&m.win){var f="",h;for(h in a)a[h]!=Object.prototype[h]&&("data"==h.toLowerCase()?b.movie=a[h]:"styleclass"==h.toLowerCase()?f+=' class="'+a[h]+'"':"classid"!=h.toLowerCase()&&
(f+=" "+h+'="'+a[h]+'"'));h="";for(var g in b)b[g]!=Object.prototype[g]&&(h+='<param name="'+g+'" value="'+b[g]+'" />');d.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+f+">"+h+"</object>";Q[Q.length]=a.id;e=n(a.id)}else{g=p.createElement(C);g.setAttribute("type",v);for(var l in a)a[l]!=Object.prototype[l]&&("styleclass"==l.toLowerCase()?g.setAttribute("class",a[l]):"classid"!=l.toLowerCase()&&g.setAttribute(l,a[l]));for(f in b)b[f]!=Object.prototype[f]&&"movie"!=f.toLowerCase()&&
(a=g,h=f,l=b[f],c=p.createElement("param"),c.setAttribute("name",h),c.setAttribute("value",l),a.appendChild(c));d.parentNode.replaceChild(g,d);e=g}return e}function t(a){var b=n(a);b&&"OBJECT"==b.nodeName&&(m.ie&&m.win?(b.style.display="none",function(){if(4==b.readyState){var c=n(a);if(c){for(var e in c)"function"==typeof c[e]&&(c[e]=null);c.parentNode.removeChild(c)}}else setTimeout(arguments.callee,10)}()):b.parentNode.removeChild(b))}function n(a){var b=null;try{b=p.getElementById(a)}catch(c){}return b}
function s(a,b,c){a.attachEvent(b,c);J[J.length]=[a,b,c]}function q(a){var b=m.pv;a=a.split(".");a[0]=parseInt(a[0],10);a[1]=parseInt(a[1],10)||0;a[2]=parseInt(a[2],10)||0;return b[0]>a[0]||b[0]==a[0]&&b[1]>a[1]||b[0]==a[0]&&b[1]==a[1]&&b[2]>=a[2]?!0:!1}function y(a,b,c,e){if(!m.ie||!m.mac){var d=p.getElementsByTagName("head")[0];d&&(c=c&&"string"==typeof c?c:"screen",e&&(S=D=null),D&&S==c||(e=p.createElement("style"),e.setAttribute("type","text/css"),e.setAttribute("media",c),D=d.appendChild(e),
m.ie&&m.win&&typeof p.styleSheets!=u&&0<p.styleSheets.length&&(D=p.styleSheets[p.styleSheets.length-1]),S=c),m.ie&&m.win?D&&typeof D.addRule==C&&D.addRule(a,b):D&&typeof p.createTextNode!=u&&D.appendChild(p.createTextNode(a+" {"+b+"}")))}}function x(a,b){if(T){var c=b?"visible":"hidden";H&&n(a)?n(a).style.visibility=c:y("#"+a,"visibility:"+c)}}function z(a){return null!=/[\\\"<>\.;]/.exec(a)&&typeof encodeURIComponent!=u?encodeURIComponent(a):a}var u="undefined",C="object",v="application/x-shockwave-flash",
B="SWFObjectExprInst",w=window,p=document,F=navigator,I=!1,N=[function(){I?e():d()}],E=[],Q=[],J=[],K,P,G,L,H=!1,O=!1,D,S,T=!0,m=function(){var a=typeof p.getElementById!=u&&typeof p.getElementsByTagName!=u&&typeof p.createElement!=u,b=F.userAgent.toLowerCase(),c=F.platform.toLowerCase(),e=c?/win/.test(c):/win/.test(b),c=c?/mac/.test(c):/mac/.test(b),b=/webkit/.test(b)?parseFloat(b.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,d=!+"\v1",f=[0,0,0],h=null;if(typeof F.plugins!=u&&typeof F.plugins["Shockwave Flash"]==
C)!(h=F.plugins["Shockwave Flash"].description)||typeof F.mimeTypes!=u&&F.mimeTypes[v]&&!F.mimeTypes[v].enabledPlugin||(I=!0,d=!1,h=h.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),f[0]=parseInt(h.replace(/^(.*)\..*$/,"$1"),10),f[1]=parseInt(h.replace(/^.*\.(.*)\s.*$/,"$1"),10),f[2]=/[a-zA-Z]/.test(h)?parseInt(h.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof w.ActiveXObject!=u)try{var g=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");g&&(h=g.GetVariable("$version"))&&(d=!0,h=h.split(" ")[1].split(","),
f=[parseInt(h[0],10),parseInt(h[1],10),parseInt(h[2],10)])}catch(l){}return{w3:a,pv:f,wk:b,ie:d,win:e,mac:c}}();(function(){m.w3&&((typeof p.readyState!=u&&"complete"==p.readyState||typeof p.readyState==u&&(p.getElementsByTagName("body")[0]||p.body))&&k(),H||(typeof p.addEventListener!=u&&p.addEventListener("DOMContentLoaded",k,!1),m.ie&&m.win&&(p.attachEvent("onreadystatechange",function(){"complete"==p.readyState&&(p.detachEvent("onreadystatechange",arguments.callee),k())}),w==top&&function(){if(!H){try{p.documentElement.doScroll("left")}catch(a){setTimeout(arguments.callee,
0);return}k()}}()),m.wk&&function(){H||(/loaded|complete/.test(p.readyState)?k():setTimeout(arguments.callee,0))}(),f(k)))})();(function(){m.ie&&m.win&&window.attachEvent("onunload",function(){for(var a=J.length,b=0;b<a;b++)J[b][0].detachEvent(J[b][1],J[b][2]);a=Q.length;for(b=0;b<a;b++)t(Q[b]);for(var c in m)m[c]=null;m=null;for(var e in A)A[e]=null;A=null})})();return{registerObject:function(a,b,c,e){if(m.w3&&a&&b){var d={};d.id=a;d.swfVersion=b;d.expressInstall=c;d.callbackFn=e;E[E.length]=d;x(a,
!1)}else e&&e({success:!1,id:a})},getObjectById:function(a){if(m.w3)return c(a)},embedSWF:function(c,e,d,f,h,l,k,n,p,t){var s={success:!1,id:e};m.w3&&!(m.wk&&312>m.wk)&&c&&e&&d&&f&&h?(x(e,!1),a(function(){d+="";f+="";var a={};if(p&&typeof p===C)for(var m in p)a[m]=p[m];a.data=c;a.width=d;a.height=f;m={};if(n&&typeof n===C)for(var v in n)m[v]=n[v];if(k&&typeof k===C)for(var w in k)m.flashvars=typeof m.flashvars!=u?m.flashvars+("&"+w+"="+k[w]):w+"="+k[w];if(q(h))v=r(a,m,e),a.id==e&&x(e,!0),s.success=
!0,s.ref=v;else{if(l&&g()){a.data=l;b(a,m,e,t);return}x(e,!0)}t&&t(s)})):t&&t(s)},switchOffAutoHideShow:function(){T=!1},ua:m,getFlashPlayerVersion:function(){return{major:m.pv[0],minor:m.pv[1],release:m.pv[2]}},hasFlashPlayerVersion:q,createSWF:function(a,b,c){if(m.w3)return r(a,b,c)},showExpressInstall:function(a,c,e,d){m.w3&&g()&&b(a,c,e,d)},removeSWF:function(a){m.w3&&t(a)},createCSS:function(a,b,c,e){m.w3&&y(a,b,c,e)},addDomLoadEvent:a,addLoadEvent:f,getQueryParamValue:function(a){var b=p.location.search||
p.location.hash;if(b){/\?/.test(b)&&(b=b.split("?")[1]);if(null==a)return z(b);for(var b=b.split("&"),c=0;c<b.length;c++)if(b[c].substring(0,b[c].indexOf("="))==a)return z(b[c].substring(b[c].indexOf("=")+1))}return""},expressInstallCallback:function(){if(O){var a=n(B);a&&K&&(a.parentNode.replaceChild(K,a),P&&(x(P,!0),m.ie&&m.win&&(K.style.display="block")),G&&G(L));O=!1}}}}();(function(){if(!window.WebSocket){var k=window.console;k&&k.log&&k.error||(k={log:function(){},error:function(){}});A.hasFlashPlayerVersion("10.0.0")?
("file:"==location.protocol&&k.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://..."),WebSocket=function(a,f,e,d,c){var g=this;g.__id=WebSocket.__nextId++;WebSocket.__instances[g.__id]=g;g.readyState=WebSocket.CONNECTING;g.bufferedAmount=0;g.__events={};setTimeout(function(){WebSocket.__addTask(function(){WebSocket.__flash.create(g.__id,a,f,e||null,d||0,c||null)})},0)},WebSocket.prototype.send=function(a){if(this.readyState==
WebSocket.CONNECTING)throw"INVALID_STATE_ERR: Web Socket connection has not been established";a=WebSocket.__flash.send(this.__id,encodeURIComponent(a));if(0>a)return!0;this.bufferedAmount+=a;return!1},WebSocket.prototype.close=function(){this.readyState!=WebSocket.CLOSED&&this.readyState!=WebSocket.CLOSING&&(this.readyState=WebSocket.CLOSING,WebSocket.__addTask(function(){WebSocket.__flash.close(this.__id)}))},WebSocket.prototype.addEventListener=function(a,f,e){a in this.__events||(this.__events[a]=
[]);this.__events[a].push(f)},WebSocket.prototype.removeEventListener=function(a,f,e){if(a in this.__events)for(a=this.__events[a],e=a.length-1;0<=e;--e)if(a[e]===f){a.splice(e,1);break}},WebSocket.prototype.dispatchEvent=function(a){for(var f=this.__events[a.type]||[],e=0;e<f.length;++e)f[e](a);(f=this["on"+a.type])&&f(a)},WebSocket.prototype.__handleEvent=function(a){"readyState"in a&&(this.readyState=a.readyState);if("open"==a.type||"error"==a.type)a=this.__createSimpleEvent(a.type);else if("close"==
a.type)a=this.__createSimpleEvent("close");else if("message"==a.type)a=decodeURIComponent(a.message),a=this.__createMessageEvent("message",a);else throw"unknown event type: "+a.type;this.dispatchEvent(a)},WebSocket.prototype.__createSimpleEvent=function(a){if(document.createEvent&&window.Event){var f=document.createEvent("Event");f.initEvent(a,!1,!1);return f}return{type:a,bubbles:!1,cancelable:!1}},WebSocket.prototype.__createMessageEvent=function(a,f){if(document.createEvent&&window.MessageEvent&&
!window.opera){var e=document.createEvent("MessageEvent");e.initMessageEvent("message",!1,!1,f,null,null,window,null);return e}return{type:a,data:f,bubbles:!1,cancelable:!1}},WebSocket.CONNECTING=0,WebSocket.OPEN=1,WebSocket.CLOSING=2,WebSocket.CLOSED=3,WebSocket.__flash=null,WebSocket.__instances={},WebSocket.__tasks=[],WebSocket.__nextId=0,WebSocket.loadFlashPolicyFile=function(a){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(a)})},WebSocket.__initialize=function(){if(!WebSocket.__flash)if(document.body)if(WebSocket.__swfLocation&&
(window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation),window.WEB_SOCKET_SWF_LOCATION){var a=document.createElement("div");a.id="webSocketContainer";a.style.position="absolute";WebSocket.__isFlashLite()?(a.style.left="0px",a.style.top="0px"):(a.style.left="-100px",a.style.top="-100px");var f=document.createElement("div");f.id="webSocketFlash";a.appendChild(f);document.body.appendChild(a);A.embedSWF(G,"webSocketFlash","1","1","10.0.0",null,null,{hasPriority:!0,swliveconnect:!0,allowScriptAccess:"always"},
null,function(a){a.success||k.error("[WebSocket] swfobject.embedSWF failed")})}else k.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf");else window.addEventListener?window.addEventListener("load",WebSocket.__initialize,!1):window.attachEvent("onload",WebSocket.__initialize)},WebSocket.__onFlashInitialized=function(){setTimeout(function(){WebSocket.__flash=document.getElementById("webSocketFlash");WebSocket.__flash.setCallerUrl(location.href);WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);
for(var a=0;a<WebSocket.__tasks.length;++a)WebSocket.__tasks[a]();WebSocket.__tasks=[]},0)},WebSocket.__onFlashEvent=function(){setTimeout(function(){try{for(var a=WebSocket.__flash.receiveEvents(),f=0;f<a.length;++f)WebSocket.__instances[a[f].webSocketId].__handleEvent(a[f])}catch(e){k.error(e)}},0);return!0},WebSocket.__log=function(a){k.log(decodeURIComponent(a))},WebSocket.__error=function(a){k.error(decodeURIComponent(a))},WebSocket.__addTask=function(a){WebSocket.__flash?a():WebSocket.__tasks.push(a)},
WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes)return!1;var a=window.navigator.mimeTypes["application/x-shockwave-flash"];return a&&a.enabledPlugin&&a.enabledPlugin.filename?a.enabledPlugin.filename.match(/flashlite/i)?!0:!1:!1},window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION||WebSocket.__initialize()):k.error("Flash Player >= 10.0.0 is required.")}})();(function(k){k.Twilio=k.Twilio||{};k.Twilio._phpjs_atob=function(a){var f,e,d,c,g,b=0,h=0;c="";var l=[];if(!a)return a;
a+="";do f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(b++)),e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(b++)),c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(b++)),g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(b++)),d=f<<18|e<<12|c<<6|g,f=d>>16&255,e=d>>8&255,d&=255,64==c?l[h++]=String.fromCharCode(f):64==g?l[h++]=String.fromCharCode(f,
e):l[h++]=String.fromCharCode(f,e,d);while(b<a.length);c=l.join("");a=[];f=l=g=h=b=0;for(c+="";b<c.length;)g=c.charCodeAt(b),128>g?(a[h++]=String.fromCharCode(g),b++):191<g&&224>g?(l=c.charCodeAt(b+1),a[h++]=String.fromCharCode((g&31)<<6|l&63),b+=2):(l=c.charCodeAt(b+1),f=c.charCodeAt(b+2),a[h++]=String.fromCharCode((g&15)<<12|(l&63)<<6|f&63),b+=3);return c=a.join("")};k.Twilio._phpjs_btoa=function(a){var f,e,d,c,g=0,b=0,h="",h=[];if(!a)return a;a+="";if(null===a||"undefined"===typeof a)a="";else{a+=
"";f="";e=d=c=0;c=a.length;for(var l=0;l<c;l++){var k=a.charCodeAt(l),t=null;128>k?d++:t=127<k&&2048>k?String.fromCharCode(k>>6|192)+String.fromCharCode(k&63|128):String.fromCharCode(k>>12|224)+String.fromCharCode(k>>6&63|128)+String.fromCharCode(k&63|128);null!==t&&(d>e&&(f+=a.slice(e,d)),f+=t,e=d=l+1)}d>e&&(f+=a.slice(e,c));a=f}do f=a.charCodeAt(g++),e=a.charCodeAt(g++),d=a.charCodeAt(g++),c=f<<16|e<<8|d,f=c>>18&63,e=c>>12&63,d=c>>6&63,c&=63,h[b++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c);while(g<a.length);h=h.join("");switch(a.length%3){case 1:h=h.slice(0,-2)+"==";break;case 2:h=h.slice(0,-1)+"="}return h}})(window);(function(k){function a(e){if(!(this instanceof a))return new a(e);if("number"!=typeof e||1>e)return null;this.channels=1;this.bitdepth=
16;this.samplerate=e;this.sine=[];for(var d=2*Math.PI/parseFloat(e),c=0;c<e;c++)this.sine.push(Math.sin(c*d))}var f={amplify:function(a){return function(d){return d*a}},ushort:function(a){return String.fromCharCode(255&a,255&a>>8)},ulong:function(a){return String.fromCharCode(255&a,255&a>>8,255&a>>16,255&a>>24)},gcd:function(a,d){for(;d;){var c=a;a=d;d=c%d}return a},lcm:function(a,d){return Math.floor(a*d/f.gcd(a,d))},compose:function(a){return function(d){for(var c=0;c<a.length;c++)d=a[c](d);return d}},
map:function(a,d){for(var c=[],f=0;f<d.length;f++)c.push(a.call(this,d[f]));return c},getattr:function(a){return function(d){return d[a]}},zip:function(){if(0==arguments.length)return[];for(var a=Array.prototype.slice.call(arguments),d=[],c=Math.min.apply(null,f.map(f.getattr("length"),a)),g=0;g<c;g++)d.push(f.map(f.getattr(g),a));return d},sum:function(a){return f.foldl(function(a,c){return a+c},a)},bind:function(a,d){return function(){var c=Array.prototype.slice.call(arguments);return d.apply(a,
c)}},foldl:function(a,d){if(1==d.length)return d[0];for(var c=a(d[0],d[1]),f=2;f<d.length;f++)c=a(c,d[f]);return c},mulmod:function(a,d,c){return a*d%c},range:function(a){for(var d=[],c=0;c<a;c++)d.push(c);return d}};a.prototype={generate:function(a){a=a instanceof Array?a:[a];var d=f.bind(this,f.map),c=d(function(a){return f.lcm(this.samplerate,a)/a},a),c=f.foldl(f.lcm,c),g=function(a){return function(c){return this.sine[f.mulmod(a,c,this.samplerate)]}};return d(function(b){return f.sum(d(g(b),a))},
f.range(c))},encode:function(e,d,c){e=e instanceof Array?e:[e];c=f.compose((c||[]).concat([f.ushort]));e=f.map(c,this.generate(e));c=Math.ceil(d*this.samplerate/e.length);e=Array(c+1).join(e.join("")).substr(0,this.samplerate*d*2);d=["fmt ",f.ulong(a.PCM_CHUNK_SIZE),f.ushort(a.LINEAR_QUANTIZATION),f.ushort(this.channels),f.ulong(this.samplerate),f.ulong(this.samplerate*this.channels*this.bitdepth/8),f.ushort(this.bitdepth/8),f.ushort(this.bitdepth)].join("");e=["data",f.ulong(e.length*this.channels*
this.bitdepth/8),e].join("");return[["RIFF",f.ulong(4+(8+d.length)+(8+e.length)),"WAVE"].join(""),d,e].join("")},play:function(a,d,c){c=c||[];a=btoa(this.encode(a,d,c));d=document.createElement("audio");d.src="data:audio/x-wav;base64,"+a;d.play()}};a.LINEAR_QUANTIZATION=1;a.PCM_CHUNK_SIZE=16;a.utils=f;k.Beep=a})(window[window.NS_BEEP]||window);(function(k){function a(b){this.id=a.nextId++;a.items[this.id]=this;this.create()}var f={create:function(){this.audio=document.createElement("audio");this.playing=
!1},buffer:function(){},play:function(a,c){if(!(this.playing||0>=c)){if(this.audio.currentTime!==a)try{if(this.audio.currentTime=a,this.audio.currentTime!==a)throw Error();}catch(d){var e=this.audio.src;this.audio.src="";this.audio.src=e}this.playing=!0;this.audio.play();var f=this;this.audio.addEventListener("ended",function R(){f.audio.removeEventListener("ended",R,!1);f.playing?(f.playing=!1,f.play(a,c-1)):f.playing=!1},!1)}},load:function(a){this.audio.src=a},stop:function(){this.playing=!1},
destroy:function(){this.audio.src="";delete this.audio}},e={create:function(){var b=this.id;a.queue(function(){a.flash.__create(b)})},buffer:function(b){var c=this.id;a.queue(function(){a.flash.__buffer(c,b)})},play:function(b,c){b=b||0;c=c||0;var d=this.id;a.queue(function(){a.flash.__play(d,b,c)})},load:function(b){var c=this.id;a.queue(function(){a.flash.__load(c,b)})},stop:function(){var b=this.id;a.queue(function(){a.flash.__stop(b)})},destroy:function(){var b=this.id;a.queue(function(){a.flash.__destroy(b);
delete a.items[b]})}},d={create:function(){},buffer:function(a){},play:function(a,c){},load:function(a){},stop:function(){},destroy:function(){}},c={initializeFlash:function(b){b=b||{};b.swfLocation=b.swfLocation||"SoundMain.swf";b.domId=b.domId||"__soundFlash__";if(!a.flash)if(document.body){var c=document.createElement("div");c.id=b.domId;document.body.appendChild(c);a.flash=c;A.embedSWF(b.swfLocation,b.domId,"1","1","10.0.0",null,{namespace:"Twilio.Sound"},{hasPriority:!0,allowScriptAccess:"always"},
null,function(b){a.log("Embed "+(b.success?"succeeded":"failed"))})}else try{window.addEventListener("load",function(){a.initializeFlash(b)},!1)}catch(d){window.attachEvent("onload",function(){a.initializeFlash(b)})}},log:function(b,c,d){if(a.debug&&window.console&&(d=d||"log",console[d]("[Sound] "+b),"undefined"!=typeof c))console[d](c)},queue:function(b){a.initialized?b():a.tasks.push(b)}},g={__onFlashInitialized:function(){a.initialized=!0;a.flash=document.getElementById(a.flash.id);setTimeout(function(){a.flash.__setDebug(a.debug);
a.log("Initialized and ready");for(var b=0;b<a.tasks.length;b++)a.tasks[b]()},0)},__onLog:function(b){a.log(b)}};a.nextId=0;a.debug=!1;a.tasks=[];a.items={};a.initialize=function(b){if(!b.forceFlash&&document.createElement("audio"))a.prototype=f;else if(A.hasFlashPlayerVersion("10.0.0")){a.prototype=e;for(var h in c)a[h]=c[h];for(h in g)a[h]=g[h];a.initializeFlash(b)}else a.prototype=d,"undefined"!=typeof console&&(console.error||console.log||function(){})("WARNING: Audio sounds disabled. HTML5 audio support or Flash Player >= 10.0.0 is required")};
k.Sound=a})(this.Twilio);(function(k){function a(b,c){this.__id=a.__nextId++;var d=function(){};this.onclose=this.onerror=this.onopen=d;this._uri=(b?"rtmps":"rtmp")+"://"+c+"/chunder";a.__instances[this.__id]=this}function f(a,c){if(document.body){var d=document.createElement("div");d.style.position="absolute";d.appendChild(a);document.body.appendChild(d);c()}else{d=function(){f(a,c)};try{window.addEventListener("load",d,!1)}catch(e){window.attachEvent("onload",d)}}}var e=B("twilio/util");a.prototype=
{openHelper:function(b,c,d,e,f){a.__queue(function(){var g=a.getMicrophones().length==d;c?(!g&&a.isMicMuted()&&e(),b()):g?b("No microphone is available"):a.isMicMuted()?f(function(){a.isMicMuted()?b("User denied access to microphone.",31208):b()}):b()})},uri:function(){return this._uri},open:function(){var b=this,c=Array.prototype.slice.call(arguments);a.__queue(function(){a.__flash.open.apply(a.__flash,[b.__id].concat(c))})},exec:function(){var b=this,c=Array.prototype.slice.call(arguments);a.__queue(function(){a.__flash.exec.apply(a.__flash,
[b.__id].concat(c))})},close:function(){var b=this;a.__queue(function(){a.__flash.close(b.__id)})},play:function(){var b=this,c=Array.prototype.slice.call(arguments);a.__queue(function(){a.__flash.playStream.apply(a.__flash,[b.__id].concat(c))})},publish:function(b,c){var d=this;a.__queue(function(){a.__flash.publish(d.__id,b,c)})},attachAudio:function(b){var c=this;a.__queue(function(){a.__flash.attachAudio(c.__id,b)})},detachAudio:function(){var b=this;a.__queue(function(){a.__flash.detachAudio(b.__id)})},
__handleEvent:function(a){switch(a.type){case "gatewayError":case "securityError":case "asyncError":case "ioError":this.onerror.call(this,a);break;case "netStatus":this.__handleNetStatus(a)}},__handleNetStatus:function(b){a.log("Event info code: "+b.info.code);switch(b.info.code){case "NetConnection.Connect.Failed":case "NetConnection.Connect.Rejected":a.log("Connection failed or was rejected");this.onerror.call(this,b);break;case "NetConnection.Connect.Closed":a.log("Connection closed");this.onclose.call(this,
b);break;case "NetConnection.Connect.Success":a.log("Connection established");this.onopen.call(this);break;default:a.log("Unexpected event: "+b.info.code)}}};var d={__queue:function(b){a.initialized?b():a.__tasks.push(b)},initialize:function(b){if(!A.hasFlashPlayerVersion("10.0.0"))throw new e.Exception("Flash Player >= 10.0.0 is required.");if(!a.__flash)if(b=b||{},b.swfLocation=b.swfLocation||"MediaStreamMain.swf",b.domId=b.domId||"__connectionFlash__",b.loader=b.loader||f,document.body){var c=
document.createElement("div");c.id=b.domId;b.loader(c,function(){a.__flash=c;var d={};"objectEnc"in b&&(d.objectEnc=b.objectEnc);d.namespace="Twilio.MediaStream";A.embedSWF(b.swfLocation,b.domId,"215","138","10.0.0",null,d,{hasPriority:!0,allowScriptAccess:"always"},null,function(b){a.log("Embed "+(b.success?"succeeded":"failed"))})})}else try{window.addEventListener("load",function(){a.initialize(b)},!1)}catch(d){window.attachEvent("onload",function(){a.initialize(b)})}},setMicrophoneGain:function(b){a.__queue(function(){try{a.__flash.setMicrophoneGain(b)}catch(c){a.log(c)}})},
setMicrophone:function(b,c){a.__queue(function(){a.__flash.setMicrophone(b,c)})},getMicrophone:function(){return a.initialized?a.__flash.getMicrophone():null},getMicrophones:function(){return a.initialized?a.__flash.getMicrophones():[]},setUseEchoSuppression:function(b){a.__queue(function(){try{a.__flash.setUseEchoSupression(b)}catch(c){a.log(c)}})},setSilenceLevel:function(b,c){a.__queue(function(){try{a.__flash.setSilenceLevel(b,c)}catch(d){a.log(d)}})},showSettings:function(){a.__queue(function(){a.__flash.showSettings()})},
isMicMuted:function(){try{return a.__flash.isMicMuted()}catch(b){if(!(b instanceof TypeError))throw b;}},log:function(b,c,d){if(a.__debug&&window.console&&(d=d||"log",console[d]("[MediaStream] "+b),"undefined"!=typeof c))console[d](c)}},c={__onFlashInitialized:function(){a.__flash=document.getElementById(a.__flash.id);setTimeout(function(){a.initialized=!0;a.__flash.setDebug(a.__debug);/Mac OS X.*Chrome\/2[34]/.test(navigator.userAgent)?a.setMicrophone(-1,!1):a.setMicrophone(-1,!0);var b=a.getMicrophone();
a.log(b?"Using "+b:"No mics available");a.setMicrophoneGain(75);for(b=0;b<a.__tasks.length;b++)a.__tasks[b].call()},0)},__onMediaStreamEvent:function(){setTimeout(function(){for(var b=a.__flash.dequeueEvents(),c=0;c<b.length;c++)try{a.log("Received event: "+b[c].type),a.__instances[b[c].mediaStreamId].__handleEvent(b[c])}catch(d){a.log("Error while processing "+b[c].type+": "+d.message,d,"error")}},0)},__onLog:function(b){"error"==b.level?a.log(b.message,void 0,"error"):a.log(b.message)}},g;for(g in d)a[g]=
d[g];for(g in c)a[g]=c[g];a.__nextId=0;a.__flash=null;a.__instances={};a.__tasks=[];a.__debug=!1;a.initialized=!1;a.AMF0=0;a.AMF3=3;k.MediaStream=a})(this.Twilio);var y=document.createElement("audio"),L=!0;try{L=!(y.canPlayType&&y.canPlayType("audio/mpeg").replace(/no/,""))}catch(U){}Twilio.Sound.initialize({swfLocation:z+"SoundMain.swf",forceFlash:L});var I=B("twilio/device").Device;I.__afterSetup(function(k,a){if(!B("twilio/rtc").enabled()){var f=B("twilio/util").decode,e=B("twilio/factories").getClass("vendor/mediastream/mediastream",
"MediaStream");e.initialize({objectEnc:e.AMF0,swfLocation:function(a,c){if(!a)return c;var e=c.match(/^(\w+):\/\/([^/]*)(.*)?/);if(!e)return c;var b=e[1],h=e[2],e=e[3];if(!/twilio.com$/.test(h.split(":")[0]))return c;var k=f(a).iss;return k?b+"://"+k.toLowerCase()+"."+h+e:c}(k,z)+"MediaStreamMain.swf",loader:function(a,c){I.dialog.insert(a,c)}})}});y=B("twilio");y.Sound=Twilio.Sound;y.MediaStream=Twilio.MediaStream;y._phpjs_atob=Twilio._phpjs_atob;y._phpjs_btoa=Twilio._phpjs_btoa;return y}());
